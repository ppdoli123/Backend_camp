<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>HTML 5 Boilerplate</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.socket.io/4.5.3/socket.io.min.js"
      integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi"
      crossorigin="anonymous"
    ></script>
<script>
      // const socket = io();


      // const enter = () => {
      //   let data = document.getElementById("name").value;
      //   socket.emit("enter_list", data);
      // };

      // socket.on("enter", (data) => {
      //   if (data.num < 3){
      //       window.location.href = '/index';
      //       console.log(data.num);
      //       socket.emit("user_name",data.id);
      //   }
      // });


</script>
<body>
    <div id="wait" class="container-fluid" >
        <div class="row">
          <div class="col-3"></div>
          <div class="col-6">
            <form name ="a" action="#">
              <input
                type="text"
                name="id"
                class="form-control mb-3"
                id="name"
                placeholder="이름을 입력하시오"
                autocomplete="off"
              />
            </form>
              <button value="ready" onclick="checkvalue()">
                ready
              </button>
              
            <div id="myid"></div>
          </div>
          <div class="col-3">
          </div>
    </div>
    </div>

    <div id="index" class="d-none">
      <div class="row">
        <div class="col-3">
        </div>
        <div class="col-6">
          <ul id="messages_1" type="none">
            <li id="username"></li>
          <ul id="messages" type="none">
            <li id="usercount"></li>
        </ul>
          <div id="msg"></div>
          <form action="#">
            <input
              type="text"
              class="form-control mb-3 disabled"
              id="input_msg"
              placeholder="역입력하기"
              autocomplete="off"
            />
          </form>
          <button id="submit" class="btn btn-primary mb-3 disabled" onclick="submit()">
            submit
            </button>

        </div>
        <div class="col-3"></div>
      </div>
    </div>
</body>
<script>
          let turn; 
          const list_data=[];
          const socket = io();
          const name=[];
      function checkvalue() {
        const fieldset1 = document.getElementById('wait');
        const fieldset2 = document.getElementById('index');
        
        if(a.id.value ==0) {
            alert("입력하세요"); 
           
          } else {
           alert("입장");
           let data = a.id.value;
           socket.emit("enter_list", data);
           name.push(data);
           fieldset1.className = "d-none";
           fieldset2.className = "container-fluid"
          }
        }   
        //들어올때
      socket.on("enter", (data) => {
        if (data.num < 3){
            console.log(data.id);
            var userCounter = document.getElementById('usercount');
            userCounter.innerText = "현재 " + data.num + "명이 서버에 접속해있습니다.";
            var username = document.getElementById('username');
            username.innerText = `내 아이디: ${data.id}`

        }
        else if (data.num ==3){
          console.log(data.id);
          var userCounter = document.getElementById('usercount');
            userCounter.innerText = "현재 " + data.num + "명이 서버에 접속해있습니다.";
            var username = document.getElementById('username');
            username.innerText = `내 아이디: ${data.id}`
            socket.emit("start",data.id)
        }
        else{
          var username = document.getElementById('username');
            username.innerText = `대기하세요 내 아이디: ${data.id}`
        }
      });
      socket.on("start_turn",(data)=>{
        console.log(data);
          const fieldset_1 = document.getElementById('input_msg');
          const fieldset_2 = document.getElementById('submit');
          fieldset_1.className = "form-control mb-3";
          fieldset_2.className = "btn btn-primary mb-3";
        
      })

      socket.on("getID", (data) => {
        var username = document.getElementById('username');
            username.innerText = `내 아이디: ${data.id}`
          console.log(data)
      });
      const word = [
      "탕정","신창","대방","회기","신길","봉명","녹천","쌍용","온양온천","노량진","영등포","외대앞","신이문","석계","광운대","월계","창동","신도림","용산","배방","구로","가산디지털단지","금천구청","석수","안양","명학","군포","성균관대","화서","수원","독산","세류","오산대","오산","진위","송탄","남영","금정","서정리","평택","성환","직산","광명","오류동","역곡","부천","송내","부평","동암","동인천","소사","간석","관악","주안","구일","부개","도원","온수","도화","아산","당정","방학","도봉","망월사","회룡","의정부","의왕","병점","두정","서동탄","제물포","양주","덕계","덕정","지행","동두천중앙","동두천","세마","평택지제","개봉","백운","도봉산","소요산","가능","녹양","보산","서울역","시청","종각","종로3가","종로5가","동대문","신설동","제기동","청량리","동묘앞",
    ];
      // 메시지 입력할때 
      socket.on("msg", (data) => {
        if (word.indexOf(data.message) > -1) { 
        if (list_data.indexOf(data.message)>-1) { 
          alert(`중복단어입니다 따라서 ${data.id}님이 패배하셨습니다`); 
          socket.emit("score_list",data.id);
          return; 
          } 
       else{
        let log = document.getElementById("msg");
        let ptag = document.createElement("p");
        let node = document.createTextNode(
          `${data.id}:${data.message}`
        );
        ptag.appendChild(node);
        log.appendChild(ptag);
        list_data.push(data.message);
        console.log(data.id, "에서 보낸 메시지 : ", data.message);
       }}
       else
       return;
      });

      const submit = () => {
        let data = document.getElementById("input_msg").value;
        socket.emit("input", data);
      };
</script>